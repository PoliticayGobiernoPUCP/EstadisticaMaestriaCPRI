<br> 
<center><img src="http://i.imgur.com/tveTlt8.png" width="300"></center>

## Curso: Estadística Para el Análisis Político<br> Semestre 2018-I<br> 
### Prof. José Manuel Magallanes, PhD 
____
## **Exploración de Datos**
____

<a id='beginning'></a>

La exploración de datos tiene en cuenta:

* El tipo de escala en que estén los datos (dicotómica, politómica, etc.); y las combinaciones entre estas.
* La detección del comportamiento de los datos y su afinidad (o no) con algun modelo teórico.

Los contenidos para esta sesión se organizan asi:

1. __AED Univariado__

* Categóricos

    * [Dicotómicos](#Dichotomous)
    * Politomicos
        * [No-Ordinal](#Nordinal)
        * [Ordinal](#Ordinal)

* Numéricos
    * [Conteos](#Counts)
    * [Mediciones](#Measurements) (ratio o intervalo)
    
2. __AED Bivariado__

* [Categorico - Categorico](#catcat) 
* [Categorico - Numérico](#catnum) 
* [Numérico - Numérico](#numnum) 

<a id='Dichotomous'></a> 

## <span style="color:blue"> Exploración de variables dicotómicas</span>

Carguemos una data de LAPOP:

```{r, eval=FALSE}
library(foreign)
folder="data"
fileName="PeruLAPOP2014.sav"
fileToRead=file.path(folder,fileName)
variables=c("estratopri","b18", "vic1ext", "q1", "q2")
dataLAPOP=read.spss(fileToRead, to.data.frame=T)[variables] #ignoremos advertencias
```

Aqui vemos como se comporta una variable dicotómica:

```{r, eval=FALSE}
table(dataLAPOP$vic1ext)
```
De manera gráfica:

```{r, eval=FALSE}
toPlot=table(dataLAPOP$vic1ext)
barplot(toPlot,col="blue", #color del gráfico
        xlab="Victimas de delincuencia", 
        ylab="Conteo de encuestados",
        main="Distribución encuestados según victimización")
```

Para verlo como porcentajes tenemos:

```{r, eval=FALSE}
prop.table(table(dataLAPOP$vic1ext)) # como plotearíamos estos resultados?
```

Es útil saber si la diferencia es significativa usando la prueba $\chi^2$ :
```{r, eval=FALSE}
distribucion=table(dataLAPOP$vic1ext)
chisq.test(distribucion)
```
Un valor significativo del p-value (menor a 0.05) sugiere que hay diferencias (se rechaza que haya comportamiento uniforme).

En esta situación, podemos considerar que la moda es relevante:
```{r, eval=FALSE}
names(distribucion[which.max(distribucion)]) #asi se obtiene
```

[Inicio](#beginning)

______
<a id='Nordinal'></a>

## <span style="color:blue"> Exploración de variables categoricas No Ordinales</span>

Exploremos el estrato de los encuestados por LAPOP:

```{r, eval=FALSE}
table(dataLAPOP$estratopri)
```

Grafiquemos nuestra variable:

```{r, eval=FALSE}
toPlot=table(dataLAPOP$estratopri)
barplot(toPlot,col="magenta",
        xlab="Zona",
        ylab= "Conteo de encuestados",
        main="Distribución de encuestados según zona",
        las=2) #cambia la orientación de los nombres de las categorías
```

Veamos la relevancia de la moda:

```{r, eval=FALSE}
distribution=table(dataLAPOP$estratopri)
chisq.test(distribution)
```

El resultado sugiere que la moda es significativa. La moda es:

```{r, eval=FALSE}
names(distribution[which.max(distribution)])
```

Otra manera de ver la representatividad o dispersión de la moda es mediante el uso del [Gini Index](https://en.wikipedia.org/wiki/Gini_coefficient):

```{r, eval=FALSE}
library(DescTools)  # instalar antes!
Gini(table(dataLAPOP$estratopri),na.rm = TRUE) 
```

Lima es una moda pronunciada!

[Inicio](#beginning)

<a id='Ordinal'></a>

## <span style="color:blue"> Exploración de variables categoricas Ordinales</span>

Exploremos visualmente la confianza en la policia de los encuestados por LAPOP:

```{r,eval=FALSE}
barplot(table(dataLAPOP$b18),las=1)
```


```{r, eval=FALSE}
dataLAPOP$b18=ordered(dataLAPOP$b18)
head(dataLAPOP$b18)
```

Podemos calcular mediana en ordinales:
```{r, eval=FALSE}
Median(dataLAPOP$b18,na.rm = T)
```

Confirmemos:

```{r, eval=FALSE}
cumsum(prop.table(table(dataLAPOP$b18)))
```

La moda es: 
```{r, eval=FALSE}
Mode(dataLAPOP$b18,na.rm = T)
```

Los estadísticos no coinciden! muestra asimetría que se notaba en el gráfico de barras.

```{r, eval=FALSE}
boxplot(dataLAPOP$b18)
```
Comencemos a usar **ggplot2**, paquete preferido para los gráficos. Primero uno simple:

```{r, eval=FALSE}
library(ggplot2)
data=na.omit(dataLAPOP)
varToPlot=as.numeric(data$b18)
thePlot=ggplot(data, aes(x=1,y=varToPlot)) + geom_boxplot() 
thePlot
```

Alteración:
```{r, eval=FALSE}
thePlot = thePlot + coord_flip()
thePlot
```
Etiquetando eje:

```{r, eval=FALSE}
theLabels=c("1=Mucho", "2", "3", "4", "5", "6", "7=mucho")
thePlot= thePlot + scale_y_continuous(labels= theLabels,breaks=1:7) 
thePlot
```

Otros elementos:

```{r, eval=FALSE}
thePlot + labs(title="Confianza en la Policía Nacional del Perú", y = 'Respuestas', x=NULL) + scale_x_continuous(labels= NULL, breaks = NULL)
```

Finalmente, veamos la dispersion:
```{r, eval=FALSE}
Gini(table(dataLAPOP$b18),na.rm = T)
```

[Inicio](#beginning)

----

<a id='Counts'></a>

## <span style="color:blue"> Explorando conteos</span>

La variable _edad_ puede servir para ello:

```{r, eval=FALSE}
dataLAPOP$q2
```

Convertirla en conteo: 
```{r, eval=FALSE}
dataLAPOP$q2 <- as.integer(dataLAPOP$q2)
```

Corresponde todavía el uso de barras:
```{r, eval=FALSE}
ggplot(dataLAPOP, aes(q2)) + geom_bar() 
```

Veamos sus estadísticos:

```{r, eval=FALSE}
summary(dataLAPOP$q2)
```

Un boxplot:
```{r, eval=FALSE}
ggplot(dataLAPOP, aes(x = 1, y = q2)) + geom_boxplot() +coord_flip() + labs(title="Edad Encuestados", y = "Edad", x=NULL) + scale_x_continuous(labels= NULL, breaks = NULL)
```

[Inicio](#beginning)

______

<a id='Measurements'></a>


## <span style="color:blue"> Explorando mediciones</span>

Las mediciones dan valores continuos (aceptan decimales). Utilizemos la data de IDE: 

```{r, eval=FALSE}
library(foreign)
folder="data"
fileName="idePeru2012.csv"
fileToRead=file.path(folder,fileName)
dataIDE=read.csv(fileToRead)
```

Pedimos un histograma: 
```{r, eval=FALSE}
ggplot(dataIDE,aes(x=IDE)) + geom_histogram()
```

...Y nuestro boxplot:
```{r, eval=FALSE}
ggplot(dataIDE,aes(y=IDE,x=1)) + geom_boxplot() + coord_flip() + labs(title="Indice de Densidad Estatal 2012", y="IDE", x=NULL) +  scale_x_continuous(labels= NULL, breaks = NULL) 

```

[Inicio](#beginning)

_____

<a id='catcat'></a>

## <span style="color:blue">Categórico - Categórico </span>

Utilicemos la data de LAPOP. 

Recordemos como se distribuye _victimización_:
```{r, eval=FALSE}
table(dataLAPOP$vic1ext)
```

... y _sexo_:
```{r, eval=FALSE}
table(dataLAPOP$q1)
```

La manera simple de analizar relaciones *cat-cat*  (asociación) es la **tabla de contingencia** (crosstab):
```{r, eval=FALSE}
table(dataLAPOP$q1,dataLAPOP$vic1ext)
```

Fue simple... pero R tiene otros paquetes para analizar asociación:

```{r, eval=FALSE}
library(gmodels)
CrossTable(dataLAPOP$q1,dataLAPOP$vic1ext,prop.t=F, prop.r=F, prop.c=F,prop.chisq=F)
```

Los procentajes pueden ser también por fila:
```{r, eval=FALSE}
CrossTable(dataLAPOP$q1,dataLAPOP$vic1ext,prop.t=F, prop.r=T, prop.c=F,prop.chisq=F)
```
... o por columna:
```{r, eval=FALSE}
CrossTable(dataLAPOP$q1,dataLAPOP$vic1ext,prop.t=F, prop.r=F, prop.c=T,prop.chisq=F)
```

Aquí también podemos usar el ${\chi}^2$ para testear si hay asociación entre variables:

```{r, eval=FALSE}
CrossTable(dataLAPOP$q1,dataLAPOP$vic1ext,prop.t=F, prop.r=F, prop.c=F,prop.chisq=F,chisq=T)
```

El p-value indica que no hay diferencia en la victimación según sexo. 

Ello se refleja en un gráfico: 

```{r, eval=FALSE}
legendPlot=levels(as.factor(unique(dataLAPOP$q1)))
bartable = table(dataLAPOP$q1,dataLAPOP$vic1ext)  ## tabla cruzada
barplot(bartable, beside = TRUE,legend=legendPlot)  ## gráfico

```

Una gráfical alternativa:
```{r, eval=FALSE}
library(ggplot2)                           

#volver nuestra tabla en una dataframe: 
subLAPOP=as.data.frame(table(dataLAPOP$q1,dataLAPOP$vic1ext))
names(subLAPOP)=c("sexo","victimizacion", "f")

#Grafiquemos la data:
g <- ggplot(subLAPOP, aes(sexo, victimizacion)) + geom_point(aes(size = f), colour = "green") + theme_bw() + xlab("") + ylab("") +theme(legend.position="none")
g + scale_size_continuous(range=c(5,30)) + geom_text(aes(label = f))
```


[Inicio](#beginning)

____

<a id='catnum'></a>

## <span style="color:blue">Categórico - Numérico</span>

Lo usual es ver como se comporta una variable numérica ante diversos factores. Veamos si el IDH se diferencia entre provincias capitales y provincias que no son capitales. 

```{r, eval=FALSE}
# solo las contribuciones de negocios:
p <- ggplot(dataIDE, aes(capital, IDE))
p + geom_boxplot()

```


El boxplot da mucha información, para lo anterior podría calcular los intervalos de confianza para la media:

```{r, eval=FALSE}
# Creo una funciónpara el error standard de la media (seMean):
seMean = function(x) sd(x)/sqrt(length(x))

# Media por grupo
means=aggregate(list(mean=dataIDE$IDE),
          list(capital=dataIDE$capital),mean)

# error standard por grupo: (usando mi función)
sems=aggregate(list(seMean=dataIDE$IDE),
          list(capital=dataIDE$capital),seMean)
```

Aqui vemos que tenemos hasta ahora:
```{r, eval=FALSE}
means
```
...y

```{r, eval=FALSE}
sems
```

Juntemos lo anterior en un data frame:
```{r, eval=FALSE}
#usando MERGE:
data=merge(means,sems) # capital es la 'key' para combinar
#tenemos:
data
```

Creemos mas columnas donde aparezcan los valores de los intervalos de confianza:
```{r, eval=FALSE}
# adding confidence interval limits:
data$lower=data$mean-2*data$seMean
data$upper=data$mean+2*data$seMean

## version final:
data
```

Con esto puedo graficarlos:
```{r, eval=FALSE}
# this creates a plot of  the points (means):
meanPlot = ggplot(data, aes(y=mean, x=capital)) + geom_point()

# this adds the error bars:
errorPlot = meanPlot + geom_errorbar(aes(ymin = lower, ymax = upper))

# final result
errorPlot
```

La gráfica sugiere que el hay diferencia en el IDE entre las provincias que son capital y las que no. Si aplicamos la prueba t-student, el p-value debería salir  significativo:

```{r, eval=FALSE}
t.test(dataIDE$IDE~dataIDE$capital,var.equal = T)
```

...y así fue. Podemos concluir que ambos grupos se comportan de manera diferente? 

Veamos esta gráfica de densidades:
```{r, eval=FALSE}
ggplot(dataIDE, aes(IDE, colour = capital)) +
  geom_density() 
```

Veamos algo más complejo, diferencia en el IDE según clasificación de tamaño de la provincia.

Tratemos tamaño como una variable categórica:

```{r, eval=FALSE}
dataIDE$tamano <- as.factor(dataIDE$tamano)
```

```{r, eval=FALSE}
with(dataIDE, tapply(IDE, tamano, mean) )
```

Analicemos en general las contribuciones segun tamaño de la provincia
```{r, eval=FALSE}
m <- ggplot(dataIDE, aes(x = IDE))
m + geom_histogram(bins=20) + facet_wrap(~tamano,scales = "free")
```

Serán las constribuciones diferentes? En este caso, usaremos una prueba F:
```{r, eval=FALSE}
model = aov(IDE ~ tamano, data = dataIDE)
summary(model)
```

La prueba detecta que _code_ produce diferencias. No nos dice cuáles son, por lo que debemos pedir una comparación _post hoc_ (Tukey):

```{r, eval=FALSE}
TukeyHSD(model)
```

El resultado es largo, pero podemos hacerlo sencillo:
```{r, eval=FALSE}
result=as.data.frame(TukeyHSD(model)$tamano)
result[4]<0.05
```

[Inicio](#beginning)
____

<a id='numnum'></a>

## <span style="color:blue">Numérico - Numérico</span>

Analicemos la data de IDE. Podemos hacer analisis _num-num_, más conocido como **correlacional**.Analicemos los indicadores que componen el IDE:

```{r, eval=FALSE}
res <- cor(dataIDE[,c(4:8)])
round(res, 2)
```

Veamos una gráfica:
```{r, eval=FALSE}
library(car)
scatterplotMatrix(dataIDE[,c(4:8)], 
   main="Simple Scatterplot Matrix")
```

De hecho, tenemos una versión no-paramétrica para Pearson:
```{r, eval=FALSE}
cor(dataIDE[,c(4:8)],method='spearman')
```

[Inicio](#beginning)

______


<br></br>

####[VOLVER AL SILABO](https://politicaygobiernopucp.github.io/EstadisticaPoliticaGobiernoII/)