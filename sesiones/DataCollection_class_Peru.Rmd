<br> 
<center><img src="http://i.imgur.com/tveTlt8.png" width="300"></center>

## Curso: Estadística Para el Análisis Político<br> Semestre 2018-I<br> 
### Prof. José Manuel Magallanes, PhD 
____
## **Leyendo Data desde R**
____

<a id='beginning'></a>

El primer paso para realizar cualquier tipo de análisis es tener los datos. Esto condiciona además el diseño de la investigación.

Los datos pueden estar organizados por terceros. Si es así, debemos poder leer el formato en que estén preparados. A veces los necesitamos como están, a veces hay que darle reformatearlos.

Otras veces, uno mismo recogerá los datos. Si los datos representan alguna población en su totalidad no tendremos data sesgada; si no, habrá que hechar mano de algun proceso de muestreo. Veamos los siguientes casos:

1. [Leyendo SPSS](#part1) 
2. [Leyendo XLSX](#part2) 
3. [Leyenco CSV](#part3) 
4. [Leyendo datos espaciales](#part4) 

Tener en claro la ubicación de los archivos es muy importante. Crear una carpeta para los datos nuestra maquina es la alternativa clásica, pero si es posible usar el link hacia algun repositorio puede ser más eficiente. Si los archivos estarán en la máquina, los siguientes comandos de R son de utilidad:

```{r, eval=FALSE}
# # con qué carpeta estoy trabajando?
getwd()
```

Acabas de ver donde estás, si quieres cambiar debes utilizar:
```{r, eval=FALSE}
setwd()
```
La ubicación de tu carpeta de trabajo debe estar en los parentesis.

Windows y Mac no describen las rutas de los directorios de la misma manera, por lo que es mejor usar el comando **file.path()**:
```{r, eval=FALSE}
folder="data"
fileName="anes_timeseries_2012.sav"
fileToRead=file.path(folder,fileName)
```

En _fileToRead_ estará la ruta correcta. Si hubiera una mayor secuencia de folders, **file.path** los concatenará sin problema.

____

<a id='part1'></a>

## Leyendo SPSS

Abramos este archivo desde el _American National Election Studies Survey_ (ANES):
```{r, eval=FALSE}
#instalemos el paquete "haven" primero (se toma su tiempo!)
library(haven)
folder="data"
fileName="anes_timeseries_2012.sav"
fileToRead=file.path(folder,fileName)
dataSpss=read_sav(fileToRead)
```

En **dataSpss** está un gran archivo. Creemos una data frame (base de datos) con dos variables de interés: "libcpre_self","libcpo_self". Dichas variables son resultado de un par de preguntas pre y post elecciones donde se solicita al encuestado ubicarse en algún punto de una escala de 1-7 puntos, cuyos valores extremos son "extremadamente liberal"" y "extremadamente conservador": 

```{r, eval=FALSE}
varsOfInterest=c("libcpre_self","libcpo_self")
dataSpssSub=as.data.frame(dataSpss)[varsOfInterest]
head(dataSpssSub) #veamos las primeras filas de nuestra data 
```


[Go to page beginning](#beginning)

____

<a id='part2'></a>

## Leyendo XLSX

Otro formato propietario de mucho uso es el de las hojas de cálculo en Excel. A continuación cargaremos la data del Índice de Desarrollo Humano, elaborado por PNUD, para Perú en el año 2012. La información se encuentra a nivel de provincias. 

```{r, eval=FALSE}
#instalemos el paquete "readxl" primero
library(readxl)
fileName='idhPeru.xlsx'
fileToRead=file.path(folder,fileName)
dataExcel=read_excel(fileToRead)
head(dataExcel) #Veamos las primeras filas
```

- Ubigeo: Identificación de las provincias.
- PROVINCIA: Nombre de cada provincia.
- habitantes: número de habitantes.
- IDH: Índice de Desarrollo Humano. 
- esperanza: Esperanza de vida al nacer (años).
- secundaria: Porcentaje de población con educación secundaria completa. 
- educa: Años de educación promedio de la población de 25 años a más. 
- percapitaf: Ingreso familiar per cápita. 

[Go to page beginning](#beginning)

____

<a id='part3'></a>

## Leyendo CSV

Otro formato propietario de mucho uso es el de valores separados por comas (CSV). Cargaremos la data del Índice de Densidad Estatal, elaborado por PNUD, para Perú en el año 2012. La información se encuentra a nivel de provincias. 

```{r, eval=FALSE}
library(foreign)
folder="data"
fileName="idePeru2012.csv"
fileToRead=file.path(folder,fileName)
dataCsv=read.csv(fileToRead)
head(dataCsv) #Veamos las primeras filas
```

- Ubigeo: Identificación de las provincias.
- PROVINCIA: Nombre de cada provincia.
- IDE: Índice de Densidad Estatal. 
- identidad: Porcentaje de población con acta de nacimiento o DNI.
- salud: Número de médicos por cada 10,000 habitantes.
- educacion: Tasa de asistencia a secundaria (pob. de 12 a 16 años).
- saneamiento: Porcentaje de viviendas con agua y desague. 
- electrificacion: Porcentaje de viviendas elecrificadas. 
- poblacion: Número de habitantes.
- costa: Provincia ubicada en la costa (SI/NO).
- capital: Provincia capital de la región (SI/NO).
- tamano: Clasificación de provincias según tamaño (1-5). 

[Go to page beginning](#beginning)

____

----

<a id='part4'></a>

## Recolectando Datos espaciales

Los datos especiales presentan una complejidad diferente. Este tipo de datos, además de la información de la unidad de estudio, guardan información que permite visualizar lineas, puntos y poligonos.

El formato RDS de R puede almacenar este tipo de información. Por ejemplo, si visitas la pagina web del [GADM database of Global Administrative Areas](http://www.gadm.org/country) puedes descargar mapas por país a diversos niveles subnacionales. Si visitas el link y buscas Perú puedes hacer:

```{r, eval=FALSE}
library(sp) 
PeruRegs <- readRDS(gzcon(url("http://biogeo.ucdavis.edu/data/gadm2.8/rds/PER_adm1.rds"))) # la información está a nivel de regiones! 
```

PeruRegs ya tiene la información. Si solo quieres ver los datos de cada unidad debes hacer:

```{r, eval=FALSE}
PeruRegs@data #vemos la data
```
Aqui grafico:
```{r, eval=FALSE}
plot(PeruRegs) #veamos el mapa 
```

Un formato más común son los mapas en SHAPEFILE. Hay un directorio dentro del folder _data_ donde estan varios mapas de limites administrativos del Perú:

```{r, eval=FALSE}
folder="data"
folderMap="provinciasPeru"
fileName="provinciasPeru.shp"  #la información en este caso está a nivel de provincias
fileToRead=file.path(folder,folderMap,fileName)

library(maptools)
library(rgeos)
PeruRegs_shp=readShapePoly(fileToRead)
```

*PeruRegs_shp* tiene el mapa. Salió un _warning_ pero lo podemos obviar. El gráfico funciona (demora un poco):

```{r, eval=FALSE}
plot(PeruRegs_shp) #veamos el mapa 
```

[Go to page beginning](#beginning)

____

####[VOLVER AL SILABO](https://politicaygobiernopucp.github.io/EstadisticaPoliticaGobiernoII/)